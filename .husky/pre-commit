# Pre-commit hook to validate version file edits
# Prevents accidental commits to archived version files

echo "üîç Checking for version file modifications..."

# Get staged files that match version pattern in v/ subdirectory
STAGED_VERSION_FILES=$(git diff --cached --name-only | grep -E 'content/.*/v/[0-9]+\.[0-9]+\.[0-9]+\.md$' || true)

if [ -z "$STAGED_VERSION_FILES" ]; then
  echo "‚úÖ No version files modified"
  exit 0
fi

echo ""
echo "‚ö†Ô∏è  WARNING: You are attempting to commit changes to version snapshot files:"
echo ""
echo "$STAGED_VERSION_FILES" | while read -r file; do
  echo "   - $file"
done
echo ""
echo "These are immutable snapshots that may be embedded in external courses."
echo ""
read -p "Are you sure you want to continue? (y/N): " response
echo ""

case "$response" in
  [yY][eE][sS]|[yY]) 
    echo "‚úÖ Proceeding with commit (manual override)"
    exit 0
    ;;
  *)
    echo "‚ùå Commit aborted"
    echo ""
    echo "To edit content, please modify the current version (without 'v' prefix)"
    echo "or create a new version instead."
    exit 1
    ;;
esac
